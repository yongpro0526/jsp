<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.coding404.myweb.product.ProductMapper">

    <insert id="prodRegist" parameterType="ProductVO">
        INSERT INTO PRODUCT(PROD_ENDDATE,
                            PROD_WRITER,
                            PROD_NAME,
                            PROD_PRICE,
                            PROD_COUNT,
                            PROD_DISCOUNT,
                            PROD_PURCHASE_YN,
                            PROD_CONTENT,
                            PROD_COMMENT)
        VALUES(#{prodEnddate},
               #{prodWriter},
               #{prodName},
               #{prodPrice},
               #{prodCount},
               #{prodDiscount},
               #{prodPurchaseYn},
               #{prodContent},
               #{prodComment}
              )
    </insert>

    <!-- 파라미터 두개 이상이면 pramType 생략 가능 -->
    <!--
        동적쿼리 구문
        if, choose, foreach가 있음
        if구문의 test에는 getter명이 들어갈 수 있음.
    -->
    <select id="getList" resultType="ProductVO">
        SELECT *
        FROM PRODUCT
        WHERE PROD_WRITER = #{prodWriter}
        <if test="criteria.searchName != '' and criteria.searchName != null">
            AND PROD_NAME LIKE CONCAT('%', #{criteria.searchName}, '%')
        </if>
        <if test="criteria.searchContent != '' and criteria.searchContent != null">
            AND PROD_CONTENT LIKE CONCAT('%', #{criteria.searchContent}, '%')
        </if>
<!--        <if test="criteria.startDate != '' and criteria.startDate != null">-->
<!--            <![CDATA[-->
<!--                AND PROD_ENDDATE >= #{criteria.startDate}-->
<!--            ]]>-->
<!--        </if>-->
<!--        <if test="criteria.endDate != '' and criteria.endDate != null">-->
<!--            <![CDATA[-->
<!--                AND PROD_ENDDATE <= #{criteria.endDate}-->
<!--            ]]>-->
<!--        </if>-->
        ORDER BY
        <if test="criteria.searchPrice == 'asc'">
            PROD_PRICE ASC,
        </if>
        <if test="criteria.searchPrice == 'desc'">
            PROD_PRICE DESC,
        </if>

        PROD_ID DESC
        LIMIT #{criteria.pageStart}, #{criteria.amount}
    </select>

    <select id="getTotal" resultType="int" parameterType="string">
        SELECT COUNT(*) AS total
        FROM PRODUCT
        WHERE PROD_WRITER = #{prodWriter}
        <if test="criteria.searchName != '' and criteria.searchName != null">
            AND PROD_NAME LIKE CONCAT('%', #{criteria.searchName}, '%')
        </if>
        <if test="criteria.searchContent != '' and criteria.searchContent != null">
            AND PROD_CONTENT LIKE CONCAT('%', #{criteria.searchContent}, '%')
        </if>
<!--        <if test="criteria.startDate != '' and criteria.startDate != null">-->
<!--            <![CDATA[-->
<!--                AND PROD_ENDDATE >= #{criteria.startDate}-->
<!--            ]]>-->
<!--        </if>-->
<!--        <if test="criteria.endDate != '' and criteria.endDate != null">-->
<!--            <![CDATA[-->
<!--                AND PROD_ENDDATE <= #{criteria.endDate}-->
<!--            ]]>-->
<!--        </if>-->
    </select>

    <select id="getDetail" parameterType="long">
        SELECT *
        FROM PRODUCT
        WHERE PROD_ID = #{prodId}
    </select>

    <update id="prodUpdate" parameterType="ProductVO">
        UPDATE PRODUCT
        SET PROD_ENDDATE = #{prodEnddate},
            PROD_NAME = #{prodName},
            PROD_PRICE = #{prodPrice},
            PROD_COUNT = #{prodCount},
            PROD_DISCOUNT = #{prodDiscount},
            PROD_PURCHASE_YN = #{prodPurchaseYn},
            PROD_CONTENT = #{prodContent},
            PROD_COMMENT = #{prodComment}
        WHERE PROD_ID = #{prodId}
    </update>

    <delete id="prodDelete" parameterType="long">
        DELETE FROM PRODUCT
        WHERE PROD_ID = #{prodId}
    </delete>

</mapper>